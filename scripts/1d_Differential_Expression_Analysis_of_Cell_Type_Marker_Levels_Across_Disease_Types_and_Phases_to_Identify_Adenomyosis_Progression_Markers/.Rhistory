library(ggplot2)
library(readxl)
library(dplyr)
library(limma)
library(tidyr)
library(purrr)
data_multiplex <- read_excel('../data/CD20_CD15_CD117_PanelA_JAMBROISE_WACHEUL.xlsx')
data_multiplex$Cells[data_multiplex$Cells=='T cells'] <- 'T_cells'
data_multiplex %>%
filter(Cells=='T_cells',Phase=='Menstrual') %>%
arrange(Classification) |> as.data.frame()
data_summary <- data_multiplex %>%
group_by(Phase,Image,Classification,Cells) %>%
summarise(Result=sum(Result))
dim(data_multiplex)
dim(data_summary)
data_summary  <- data.frame(data_summary,diagnostic=map_chr(.x = data_summary$Classification,.f = function(x) strsplit(x,split='_')[[1]][1]))
pdf('../results/boxplot_classification.pdf',width=15,height = 15)
ggplot(data_summary,mapping = aes(x = Classification ,y = Result,col=Classification))+
geom_boxplot()+
geom_jitter()+
facet_grid(Cells~diagnostic,scales='free')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
dev.off()
summary_multiplex <- data_multiplex %>%
group_by(Image,Type,Cells,Phase,Classification) %>%
summarise(Result=sum(Result))
View(summary_multiplex)
View(data_multiplex)
result
data_multiplex <- read_excel('../data/CD20_CD15_CD117_PanelA_JAMBROISE_WACHEUL.xlsx')
data_multiplex$Cells[data_multiplex$Cells=='T cells'] <- 'T_cells'
data_multiplex %>%
filter(Type == 'Adenomyosis',Cells=='B cells',Phase=='Menstrual') |> data.frame()
summary_multiplex <- data_multiplex %>%
group_by(Image,Type,Cells,Phase,Classification) %>%
summarise(Result=sum(Result))
summary_multiplex$Type <- factor(summary_multiplex$Type,levels=c('Control','Transition','Adenomyosis'))
pdf('../results/boxplot_diagnostic_log2.pdf',width=8,height = 12)
ggplot(summary_multiplex,mapping = aes(x = Type ,y = log2(Result+0.001),col=Type))+
geom_boxplot()+
geom_jitter(width = 0.1,size=0.5)+
facet_grid(Cells~Phase,scales='free_y')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
dev.off()
pdf('../results/boxplot_diagnostic.pdf',width=8,height = 12)
ggplot(summary_multiplex,mapping = aes(x = Type ,y = Result,col=Type))+
geom_boxplot()+
geom_jitter(width = 0.1,size=0.5)+
facet_grid(Cells~Phase,scales='free_y')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
dev.off()
summary_wide <- summary_multiplex %>%
pivot_wider(names_from = Cells,values_from = Result)
summary_wide <- data.frame(ID=paste0('S',seq(1,dim(summary_wide)[1])),summary_wide)
omic_data <- summary_wide %>%
ungroup() %>%
dplyr::select(-Image,-Type,-Phase,-Classification) %>%
column_to_rownames(var='ID')
omic_data <- t(omic_data)
summary_wide <- summary_multiplex %>%
pivot_wider(names_from = Cells,values_from = Result)
summary_wide <- data.frame(ID=paste0('S',seq(1,dim(summary_wide)[1])),summary_wide)
omic_data <- summary_wide %>%
ungroup() %>%
dplyr::select(-Image,-Type,-Phase,-Classification) %>%
column_to_rownames(var='ID')
library(dplyr)
omic_data <- summary_wide %>%
ungroup() %>%
dplyr::select(-Image,-Type,-Phase,-Classification) %>%
column_to_rownames(var='ID')
library(tidyr)
omic_data <- summary_wide %>%
ungroup() %>%
dplyr::select(-Image,-Type,-Phase,-Classification) %>%
column_to_rownames(var='ID')
library(tibble)
omic_data <- summary_wide %>%
ungroup() %>%
dplyr::select(-Image,-Type,-Phase,-Classification) %>%
column_to_rownames(var='ID')
omic_data <- t(omic_data)
omic_data <- log2(omic_data+0.001)
coldata <- summary_wide %>%
ungroup() %>%
dplyr::select(ID,Image,Type,Phase,Classification)
mydesign <- model.matrix(~Type,data = coldata)
fit <- lmFit(omic_data, mydesign)
cm <- makeContrasts( Adenomyosis_vs_control = TypeAdenomyosis, levels=mydesign)
cm
fit <- contrasts.fit(fit, cm)
efit <- eBayes(fit,trend=T,robust = T)
result <- topTable(efit, coef="Adenomyosis_vs_control",n=dim(efit)[1],genelist = rownames(omic_data))
result <- result %>% select(ID,logFC,P.Value,adj.P.Val) %>%
mutate(logFC=round(logFC,2))
result
View(result)
View(summary_wide)
ggplot(summary_multiplex,mapping = aes(x = Type ,y = Result,col=Type))+
geom_boxplot()+
geom_jitter(width = 0.1,size=0.5)+
facet_grid(Cells~Phase,scales='free_y')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
library(ggplot2)
library(readxl)
library(dplyr)
library(limma)
library(tidyr)
library(tidyverse)
library(openxlsx)
data_multiplex <- read_excel('../data/CD20_CD15_CD117_PanelA_JAMBROISE_WACHEUL.xlsx')
data_multiplex$Cells[data_multiplex$Cells=='T cells'] <- 'T_cells'
data_multiplex %>%
filter(Type == 'Adenomyosis',Cells=='B cells',Phase=='Menstrual') |> data.frame()
summary_multiplex <- data_multiplex %>%
group_by(Image,Type,Cells,Phase) %>%
summarise(Result=sum(Result))
summary_multiplex$Type <- factor(summary_multiplex$Type,levels=c('Control','Transition','Adenomyosis'))
summary_multiplex <- summary_multiplex %>%
filter(Cells!='NA',Cells!='Neutrophils')
pdf('../results/diagnostic_effect_by_celltype/scatterplot_diagnostic_phase_separated.pdf',width=6,height = 10)
ggplot(summary_multiplex,mapping = aes(x = Type ,y = Result,col=Type))+
geom_jitter(width = 0.1,size=0.5,alpha=0.6)+
stat_summary(geom="point",fun="mean",size=1.5,alpha=0.8)+
facet_grid(Cells~Phase,scales='free_y')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
dev.off()
pdf('../results/diagnostic_effect_by_celltype/scatterplot_diagnostic_phase_separated_log2.pdf',width=6,height = 10)
ggplot(summary_multiplex,mapping = aes(x = Type ,y = log2(Result+0.001),col=Type))+
geom_jitter(width = 0.1,size=0.5,alpha=0.6)+
stat_summary(geom="point",fun="mean",size=1.5,alpha=0.8)+
facet_grid(Cells~Phase,scales='free_y')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
dev.off()
pdf('../results/diagnostic_effect_by_celltype/scatterplot_diagnostic_phase_merged.pdf',width=4,height = 10)
ggplot(summary_multiplex,mapping = aes(x = Type ,y = Result,col=Type))+
geom_jitter(width = 0.1,size=0.5,alpha=0.6)+
stat_summary(geom="point",fun="mean",size=1.5,alpha=0.8)+
facet_grid(Cells~.,scales='free_y')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
dev.off()
pdf('../results/diagnostic_effect_by_celltype/scatterplot_diagnostic_phase_merged_log2.pdf',width=4,height = 10)
ggplot(summary_multiplex,mapping = aes(x = Type ,y = log2(Result+0.001),col=Type))+
geom_jitter(width = 0.1,size=0.5,alpha=0.6)+
stat_summary(geom="point",fun="mean",size=1.5,alpha=0.8)+
facet_grid(Cells~.,scales='free_y')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
dev.off()
summary_wide <- summary_multiplex %>%
pivot_wider(names_from = Cells,values_from = Result)
summary_wide <- data.frame(ID=paste0('S',seq(1,dim(summary_wide)[1])),summary_wide)
omic_data <- summary_wide %>%
ungroup() %>%
dplyr::select(-Image,-Type,-Phase,) %>%
column_to_rownames(var='ID')
omic_data <- t(omic_data)
omic_data <- log2(omic_data+0.001)
coldata <- summary_wide %>%
ungroup() %>%
dplyr::select(ID,Image,Type,Phase)
mydesign <- model.matrix(~Type,data = coldata)
fit <- lmFit(omic_data, mydesign)
cm <- makeContrasts( Adenomyosis_vs_control = TypeAdenomyosis, levels=mydesign)
cm
fit <- contrasts.fit(fit, cm)
efit <- eBayes(fit,trend=T,robust = T)
result <- topTable(efit, coef="Adenomyosis_vs_control",n=dim(efit)[1],genelist = rownames(omic_data))
result <- result %>% select(ID,logFC,P.Value,adj.P.Val) %>%
mutate(logFC=round(logFC,2))
result
ggplot(summary_multiplex,mapping = aes(x = Type ,y = log2(Result+0.001),col=Type))+
geom_boxplot()+
geom_jitter(width = 0.1,size=0.5)+
facet_grid(Cells~Phase,scales='free_y')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
dev.off()
pdf('../results/boxplot_diagnostic.pdf',width=8,height = 12)
ggplot(summary_multiplex,mapping = aes(x = Type ,y = Result,col=Type))+
geom_boxplot()+
geom_jitter(width = 0.1,size=0.5)+
facet_grid(Cells~Phase,scales='free_y')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
ggplot(summary_multiplex,mapping = aes(x = Type ,y = Result,col=Type))+
geom_boxplot()+
geom_jitter(width = 0.1,size=0.5)+
facet_grid(Cells~Phase,scales='free_y')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
ggplot(summary_multiplex,mapping = aes(x = Type ,y = Result,col=Type))+
geom_jitter(width = 0.1,size=0.5,alpha=0.6)+
stat_summary(geom="point",fun="mean",size=1.5,alpha=0.8)+
facet_grid(Cells~Phase,scales='free_y')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
dev.off()
pdf('../results/diagnostic_effect_by_celltype/scatterplot_diagnostic_phase_separated_log2.pdf',width=6,height = 10)
ggplot(summary_multiplex,mapping = aes(x = Type ,y = log2(Result+0.001),col=Type))+
geom_jitter(width = 0.1,size=0.5,alpha=0.6)+
stat_summary(geom="point",fun="mean",size=1.5,alpha=0.8)+
facet_grid(Cells~Phase,scales='free_y')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
ggplot(summary_multiplex,mapping = aes(x = Type ,y = Result,col=Type))+
geom_jitter(width = 0.1,size=0.5,alpha=0.6)+
stat_summary(geom="point",fun="mean",size=1.5,alpha=0.8)+
facet_grid(Cells~.,scales='free_y')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
ggplot(summary_multiplex,mapping = aes(x = Type ,y = log2(Result+0.001),col=Type))+
geom_jitter(width = 0.1,size=0.5,alpha=0.6)+
stat_summary(geom="point",fun="mean",size=1.5,alpha=0.8)+
facet_grid(Cells~.,scales='free_y')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
data_multiplex <- read_excel('../data/CD20_CD15_CD117_PanelA_JAMBROISE_WACHEUL.xlsx')
data_multiplex$Cells[data_multiplex$Cells=='T cells'] <- 'T_cells'
data_multiplex %>%
filter(Type == 'Adenomyosis',Cells=='B cells',Phase=='Menstrual') |> data.frame()
summary_multiplex <- data_multiplex %>%
group_by(Image,Type,Cells,Phase) %>%
summarise(Result=sum(Result))
summary_multiplex$Type <- factor(summary_multiplex$Type,levels=c('Control','Transition','Adenomyosis'))
summary_multiplex <- summary_multiplex %>%
filter(Cells!='NA',Cells!='Neutrophils')
ggplot(summary_multiplex,mapping = aes(x = Type ,y = Result,col=Type))+
geom_jitter(width = 0.1,size=0.5,alpha=0.6)+
stat_summary(geom="point",fun="mean",size=1.5,alpha=0.8)+
facet_grid(Cells~Phase,scales='free_y')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
ggplot(summary_multiplex,mapping = aes(x = Type ,y = Result,col=Type))+
geom_jitter(width = 0.1,size=0.5,alpha=0.6)+
stat_summary(geom="point",fun="mean",size=1.5,alpha=0.8)+
facet_grid(Cells~Phase,scales='free_y')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
dev.off()
#pdf('../results/diagnostic_effect_by_celltype/scatterplot_diagnostic_phase_separated.pdf',width=6,height = 10)
ggplot(summary_multiplex,mapping = aes(x = Type ,y = Result,col=Type))+
geom_jitter(width = 0.1,size=0.5,alpha=0.6)+
stat_summary(geom="point",fun="mean",size=1.5,alpha=0.8)+
facet_grid(Cells~Phase,scales='free_y')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
dev.off()
#pdf('../results/diagnostic_effect_by_celltype/scatterplot_diagnostic_phase_separated_log2.pdf',width=6,height = 10)
ggplot(summary_multiplex,mapping = aes(x = Type ,y = log2(Result+0.001),col=Type))+
geom_jitter(width = 0.1,size=0.5,alpha=0.6)+
stat_summary(geom="point",fun="mean",size=1.5,alpha=0.8)+
facet_grid(Cells~Phase,scales='free_y')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
dev.off()
#pdf('../results/diagnostic_effect_by_celltype/scatterplot_diagnostic_phase_merged.pdf',width=4,height = 10)
ggplot(summary_multiplex,mapping = aes(x = Type ,y = Result,col=Type))+
geom_jitter(width = 0.1,size=0.5,alpha=0.6)+
stat_summary(geom="point",fun="mean",size=1.5,alpha=0.8)+
facet_grid(Cells~.,scales='free_y')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
dev.off()
#pdf('../results/diagnostic_effect_by_celltype/scatterplot_diagnostic_phase_merged_log2.pdf',width=4,height = 10)
ggplot(summary_multiplex,mapping = aes(x = Type ,y = log2(Result+0.001),col=Type))+
geom_jitter(width = 0.1,size=0.5,alpha=0.6)+
stat_summary(geom="point",fun="mean",size=1.5,alpha=0.8)+
facet_grid(Cells~.,scales='free_y')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
#pdf('../results/diagnostic_effect_by_celltype/scatterplot_diagnostic_phase_separated.pdf',width=6,height = 10)
ggplot(summary_multiplex,mapping = aes(x = Type ,y = Result,col=Type))+
geom_jitter(width = 0.1,size=0.5,alpha=0.6)+
stat_summary(geom="point",fun="mean",size=1.5,alpha=0.8)+
facet_grid(Cells~Phase,scales='free_y')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
#pdf('../results/diagnostic_effect_by_celltype/scatterplot_diagnostic_phase_separated_log2.pdf',width=6,height = 10)
ggplot(summary_multiplex,mapping = aes(x = Type ,y = log2(Result+0.001),col=Type))+
geom_jitter(width = 0.1,size=0.5,alpha=0.6)+
stat_summary(geom="point",fun="mean",size=1.5,alpha=0.8)+
facet_grid(Cells~Phase,scales='free_y')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
#pdf('../results/diagnostic_effect_by_celltype/scatterplot_diagnostic_phase_separated.pdf',width=6,height = 10)
ggplot(summary_multiplex,mapping = aes(x = Type ,y = Result,col=Type))+
geom_jitter(width = 0.1,size=0.5,alpha=0.6)+
stat_summary(geom="point",fun="mean",size=1.5,alpha=0.8)+
facet_grid(Cells~Phase,scales='free_y')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
#pdf('../results/diagnostic_effect_by_celltype/scatterplot_diagnostic_phase_merged.pdf',width=4,height = 10)
ggplot(summary_multiplex,mapping = aes(x = Type ,y = Result,col=Type))+
geom_jitter(width = 0.1,size=0.5,alpha=0.6)+
stat_summary(geom="point",fun="mean",size=1.5,alpha=0.8)+
facet_grid(Cells~.,scales='free_y')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
#pdf('../results/diagnostic_effect_by_celltype/scatterplot_diagnostic_phase_separated.pdf',width=6,height = 10)
ggplot(summary_multiplex,mapping = aes(x = Type ,y = Result,col=Type))+
geom_jitter(width = 0.1,size=0.5,alpha=0.6)+
stat_summary(geom="point",fun="mean",size=1.5,alpha=0.8)+
facet_grid(Cells~Phase,scales='free_y')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
#pdf('../results/diagnostic_effect_by_celltype/scatterplot_diagnostic_phase_merged.pdf',width=4,height = 10)
ggplot(summary_multiplex,mapping = aes(x = Type ,y = Result,col=Type))+
geom_jitter(width = 0.1,size=0.5,alpha=0.6)+
stat_summary(geom="point",fun="mean",size=1.5,alpha=0.8)+
facet_grid(Cells~.,scales='free_y')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
#pdf('../results/diagnostic_effect_by_celltype/scatterplot_diagnostic_phase_separated.pdf',width=6,height = 10)
ggplot(summary_multiplex,mapping = aes(x = Type ,y = Result,col=Type))+
geom_jitter(width = 0.1,size=0.5,alpha=0.6)+
stat_summary(geom="point",fun="mean",size=1.5,alpha=0.8)+
facet_grid(Cells~Phase,scales='free_y')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
#pdf('../results/diagnostic_effect_by_celltype/scatterplot_diagnostic_phase_merged.pdf',width=4,height = 10)
ggplot(summary_multiplex,mapping = aes(x = Type ,y = Result,col=Type))+
geom_jitter(width = 0.1,size=0.5,alpha=0.6)+
stat_summary(geom="point",fun="mean",size=1.5,alpha=0.8)+
facet_grid(Cells~.,scales='free_y')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
ggplot(summary_multiplex,mapping = aes(x = Type ,y = log2(Result+0.001),col=Type))+
geom_boxplot()+
geom_jitter(width = 0.1,size=0.5)+
facet_grid(Cells~Phase,scales='free_y')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
data_multiplex <- read_excel('../data/CD20_CD15_CD117_PanelA_JAMBROISE_WACHEUL.xlsx')
data_multiplex$Cells[data_multiplex$Cells=='T cells'] <- 'T_cells'
data_multiplex %>%
filter(Type == 'Adenomyosis',Cells=='B cells',Phase=='Menstrual') |> data.frame()
summary_multiplex <- data_multiplex %>%
group_by(Image,Type,Cells,Phase,Classification) %>%
summarise(Result=sum(Result))
summary_multiplex$Type <- factor(summary_multiplex$Type,levels=c('Control','Transition','Adenomyosis'))
#pdf('../results/boxplot_diagnostic_log2.pdf',width=8,height = 12)
ggplot(summary_multiplex,mapping = aes(x = Type ,y = log2(Result+0.001),col=Type))+
geom_boxplot()+
geom_jitter(width = 0.1,size=0.5)+
facet_grid(Cells~Phase,scales='free_y')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
dev.off()
#pdf('../results/boxplot_diagnostic.pdf',width=8,height = 12)
ggplot(summary_multiplex,mapping = aes(x = Type ,y = Result,col=Type))+
geom_boxplot()+
geom_jitter(width = 0.1,size=0.5)+
facet_grid(Cells~Phase,scales='free_y')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
#pdf('../results/boxplot_diagnostic_log2.pdf',width=8,height = 12)
ggplot(summary_multiplex,mapping = aes(x = Type ,y = log2(Result+0.001),col=Type))+
geom_boxplot()+
geom_jitter(width = 0.1,size=0.5)+
facet_grid(Cells~Phase,scales='free_y')+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
